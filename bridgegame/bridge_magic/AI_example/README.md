# 智能桥牌AI服务

这是一个为魔改版桥牌开发的智能AI服务，具有高级叫牌、卡牌交换和打牌策略。

## 核心特性

### 🎯 策略性叫牌系统
- **开叫策略**: 12点以上开叫，根据牌型选择合适叫品
- **应叫策略**: 支持搭档叫牌，根据点数和牌型选择
- **竞争性叫牌**: 对对手加倍，保护搭档叫牌

### 🔄 智能卡牌交换
- **有将合约**: 
  - 庄家方交换边花短门（单张/双张）
  - 防守方交换弱花色大牌增强搭档
- **无将合约**: 交换最弱花色小牌
- **搭档协作**: 考虑搭档需求优化交换

### 🎴 高级打牌策略
- **首攻策略**:
  - 无将：攻最长花色，四大第四
  - 有将（庄家）：抽将
  - 有将（防守）：攻单张或短花色
- **跟牌策略**:
  - 搭档赢则出小牌
  - 尝试用最小赢牌
  - 垫牌时垫短花小牌

## 快速开始

### 1. 安装依赖
```bash
pip3 install flask requests
```

### 2. 启动AI服务

#### 使用启动脚本（推荐）
```bash
chmod +x start_ai.sh
./start_ai.sh 50006
```

#### 手动启动
```bash
python3 smart_bridge_ai.py --port 50006
```

#### 自定义参数
```bash
python3 smart_bridge_ai.py \
    --port 50006 \
    --ai_id "my_smart_ai" \
    --ai_name "我的智能桥牌AI"
```

### 3. 健康检查
```bash
curl -s http://localhost:50006/health
```

## API接口

### 健康检查
```bash
curl http://localhost:50006/health
```
响应：
```json
{
  "status": "healthy",
  "ai_id": "smart_bridge_ai",
  "active_games": 0
}
```

### 获取AI信息
```bash
curl http://localhost:50006/info
```

### 加入游戏
```bash
curl -X POST http://localhost:50006/join_game \
  -H "Content-Type: application/json" \
  -d '{
    "game_id": "bridge_magic_001",
    "player_id": 0,
    "player_name": "SmartAI"
  }'
```

### 获取动作
```bash
curl -X POST http://localhost:50006/get_action \
  -H "Content-Type: application/json" \
  -d '{
    "game_id": "bridge_magic_001",
    "player_id": 0,
    "position": "N",
    "game_state": {...},
    "legal_actions": [...]
  }'
```

### 离开游戏
```bash
curl -X POST http://localhost:50006/leave_game \
  -H "Content-Type: application/json" \
  -d '{"game_id": "bridge_magic_001"}'
```

## 策略详解

### 叫牌评估系统

#### 点力计算
- **大牌点（HCP）**: A=4, K=3, Q=2, J=1
- **牌型点**: 缺门+3, 单张+2, 双张+1
- **总点数** = 大牌点 + 牌型点

#### 开叫标准
- **12-14点**: 开叫一阶花色
- **15-17点**: 平衡牌型开叫1NT
- **18-20点**: 开叫二阶
- **21+点**: 考虑成局/满贯

#### 应叫标准
- **6-9点**: 简单加叫或1NT
- **10-12点**: 跳叫加叫或2NT
- **13+点**: 成局叫牌

### 卡牌交换策略

#### 有将合约（庄家方）
1. 优先交换边花单张
2. 其次交换边花双张中的小牌
3. 如将牌超过5张，交换小将

#### 有将合约（防守方）
1. 交换最弱花色的大牌
2. 给搭档增强攻击力

#### 无将合约
1. 找出最弱花色（最短且最弱）
2. 交换该花色的小牌

### 打牌策略

#### 首攻原则

**无将合约**:
- 攻最长花色
- 四大第四原则（有4张以上攻第4大）
- 否则攻最大

**有将合约（庄家）**:
- 优先抽将
- 建立长套

**有将合约（防守）**:
- 优先攻单张（盼望将吃）
- 其次攻短花色
- 避免攻送死牌型

#### 跟牌原则

1. **搭档赢时**: 出小牌（不浪费大牌）
2. **对手赢时**: 
   - 能赢用最小赢牌
   - 赢不了出小牌
3. **不能跟花时**:
   - 有将牌考虑将吃
   - 否则垫最短花色小牌

## 项目结构

```
AI_example/
├── smart_bridge_ai.py   # AI主程序
├── start_ai.sh          # 启动脚本
└── README.md            # 说明文档
```

## 技术栈

- **Python 3.7+**
- **Flask 2.3+**: Web框架
- **Requests**: HTTP客户端

## 性能指标

- **决策时间**: < 5秒
- **内存占用**: < 100MB
- **并发支持**: 支持多个游戏

## 开发说明

### 扩展建议

1. **改进叫牌**: 加入更复杂的约定叫
2. **机器学习**: 使用强化学习优化策略
3. **开局库**: 预设常见叫牌序列
4. **统计分析**: 记录对局数据分析

### 调试

查看日志文件：
```bash
tail -f smart_bridge_ai.log
# 或按端口查看
tail -f smart_bridge_ai_50006.log
```

### 停止服务

```bash
# 查找进程
lsof -i:50006

# 停止进程
kill <PID>
```

## 常见问题

**Q: 端口被占用怎么办？**
A: 启动脚本会自动尝试停止占用端口的进程。

**Q: 如何查看AI的决策过程？**
A: 查看日志文件，其中包含详细的决策理由。

**Q: AI可以同时参加多个游戏吗？**
A: 可以，AI支持并发处理多个游戏。

**Q: 如何自定义AI策略？**
A: 修改 `smart_bridge_ai.py` 中的相应方法即可。

## 许可证

本项目仅供学习和研究使用。

## 作者

智能桥牌AI开发团队

## 更新日志

### v1.0 (2025-10-11)
- ✅ 实现基本AI功能
- ✅ 策略性叫牌系统
- ✅ 智能卡牌交换
- ✅ 高级打牌策略
- ✅ 完整API接口
- ✅ 详细日志记录

